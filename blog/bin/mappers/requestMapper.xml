<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="mapper.requestMapper">
  
  <resultMap id="detailedRequest" type="Request">
  	<id property="requestId" column="request_id"/>
  	<association property="sender" column="sender_id" resultMap="mapper.userMapper.detailedUser" columnPrefix="sender_"/>
	<association property="receiver" column="receiver_id" resultMap="mapper.userMapper.detailedUser" columnPrefix="receiver_"/>
	<association property="requestStatus" column="request_status" javaType="Status">
		<id property="statusId" column="status_id"/>
		<result property="statusType" column="status_type"/>
	</association>
  </resultMap>
  
  <insert id="insertNewRequest" parameterType="Request">
  	insert into request(sender_id,request_id,request_status) 
  	values(#{sender.userId},#{receiver.userId},#{requestStatus.statusId})
  </insert>
  
  <update id="updateRequestStatus" parameterType="Request">
  	update request set request_status=#{Request.requestStatus.statusId} 
  	where request_id=#{Request.requestId}
  </update>
  
  <select id="getRequestListBySenderId" parameterType="Integer" resultMap="detailedRequest">
  	select request_id, S.user_id as sender_user_id, S.name as sender_name,
  	R.user_id as receiver_user_id, R.name as receiver_name, 
  	status_id, status_type
  	from request join user as S on request.sender_id=S.user_id 
  	join user as R on request.receiver_id=R.user_id
  	join status on request.request_status=status.status_id 
  	where sender_id=#{senderId}
  </select>
  
  </mapper>